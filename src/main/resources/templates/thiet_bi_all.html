<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      th:import="com.project3mhpl.entity.FormData">
    <head>
        <title>Quản lý thiết bị</title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"/>
       
       
        
       <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
    </head>
    <body>
        <div th:replace="header :: header"></div>
        <div class="container py-2">
            <form class="d-flex" id="searchForm">
             <input class="form-control me-2" id="searchInput" type="text" placeholder="Search"/>
             <button class="btn btn-primary" id="searchButton" type="submit">Search</button>
            </form>
        </div>
        <div class="container">
            <table class="table table_bordered">
                <thead>
                    <tr class="text-center">
                        <th>STT</th>
                        <th>Mã thiết bị</th>
                        <th>Tên thiết bị</th>
                        <th>Mô tả</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="item, loop : ${data}" class="text-center">
                        <td th:text="${loop.index+1}"></td>
                        <td th:text="${item.MaTB}"></td>
                        <td th:text="${item.TenTB}"></td>
                        <td th:text="${item.mo_tatb}"></td>
                        <td>
                            <button class="btn btn-info" id="btn_muon">Mượn</button>   
                            <button class="btn btn-primary" id="btn_datcho">Đặt chỗ</button>
                        </td>
            
                    </tr>
                </tbody>
            </table>
            <div class="toast py-4">
               <div class="toast-header">
                    Thông báo
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
               </div>
               <div class="toast-body">
                    Thiết bị đang trong thời gian được mượn!
               </div>             
            </div>
        </div>
        
        <!-- Modal -->
  <div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
          <form action="/muonthietbi" method="POST">
        <div class="modal-header">
          <h5 class="modal-title">Mượn thiết bị</h5>
        </div>
        <div class="modal-body">
           
                 <div class="form-group">
                    <label for="date">Thời gian trả:</label>
                    <div class="input-group" id="datetimepicker-3">
                        <input type="text" class="form-control" id="date-input-3" name="date"/>
                        <span class="input-group-text"  data-toggle>
                            <i class="bi bi-calendar"></i>  
                        </span>
                        <span class="input-group-text" title="clear" data-clear>
                            <i class="bi bi-x"></i>  
                        </span>
                    </div>     
                </div>
            
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Submit</button>
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
        </div>
               </form>
      </div>
    </div>
  </div>
        
          <!-- Modal -->
  <div id="myModal2" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <form action="/dat-muon-thiet-bi" method="POST">

        <div class="modal-header">
          <h5 class="modal-title">Đặt chỗ mượn thiết bị</h5>
        </div>
        <div class="modal-body">
                <div class="form-group">
                    <label for="date-input-1">Thời gian đặt chỗ:</label>
                    <div class="input-group" id="datetimepicker-1">
                        <input type="text" class="form-control" id="date-input-1" name="date"/>
                        <input type="hidden" id="idTB" name="idTB"/>
                        <span class="input-group-text"  data-toggle>
                            <i class="bi bi-calendar"></i>  
                        </span>
                        <span class="input-group-text" title="clear" data-clear>
                            <i class="bi bi-x"></i>  
                        </span>
                    </div>     
                </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Submit</button>
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
        </div>
        </form>

      </div>
    </div>
  </div>
          
          
        
    
<!--    <div class="flatpickr">
    <div class="input-group">
        <input type="text" class="form-control" id="date-input" placeholder="Chọn ngày.." />
        <a type="button" data-toggle>
            <i class="bi bi-calendar"></i>
        </a>
        <a type="button" data-clear>
            <i class="bi bi-x"></i>
        </a>
    </div>
</div>-->
       
        
     
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
   var datetimepicker3 = document.querySelector("#datetimepicker-3");
   var dateInput3 = datetimepicker3.querySelector("#date-input-3"); 
    var clearButton3 = datetimepicker3.querySelector("[data-clear]");
   var flatpickr3 = flatpickr(datetimepicker3, {
    enableTime: true,
    dateFormat: "Y-m-d H:i",
    // Các tùy chọn khác của Flatpickr
   });
    flatpickr3.config.onChange.push(function (selectedDates, dateStr) {
    dateInput3.value = dateStr;
   });
  clearButton3.addEventListener('click', function() {
    dateInput3.value = '';
  });
  
   var datetimepicker1 = document.querySelector("#datetimepicker-1");
   var dateInput1 = datetimepicker1.querySelector("#date-input-1"); 
    var clearButton1 = datetimepicker1.querySelector("[data-clear]");
   var flatpickr1 = flatpickr(datetimepicker1, {
    enableTime: true,
    dateFormat: "Y-m-d H:i",
    // Các tùy chọn khác của Flatpickr
   });
    flatpickr1.config.onChange.push(function (selectedDates, dateStr) {
    dateInput1.value = dateStr;
   });
  clearButton1.addEventListener('click', function() {
    dateInput1.value = '';
  });
  
    </script>
</body>
</html>
<script th:inline="javascript">
  document.addEventListener('DOMContentLoaded', function() {
  var tables = document.querySelector('.table');
  var buttons = tables.querySelectorAll("#btn_muon");
  var buttons2 = tables.querySelectorAll("#btn_datcho");
  
  buttons.forEach(function(button) {
    button.addEventListener('click', function() {
      var tableRow = this.closest('tr'); // Tìm dòng cha của nút được nhấp
      var toast = document.querySelector('.toast'); // Tìm toast trong dòng
      var index = 0;
      if(tableRow){
         index = tableRow.cells[1].textContent;
      }
      
      fetch('/checkData?index=' + index)
        .then(response => {
          if(response.ok){
            response.text().then(text => {
              if (text.trim() === 'modal') {
                var modalEl = document.getElementById('myModal');
                var modal = new bootstrap.Modal(modalEl);
                modal.show();
              }
              else{
                var toast = document.querySelector('.toast'); // Tìm toast trong dòng
                var toastInstance = new bootstrap.Toast(toast);
                toastInstance.show();
              }
            });
          }else {
             alert('Có lỗi xảy ra!');
          }
        });
       
    });
  });
  
  buttons2.forEach(function(button) {
    button.addEventListener('click', function() {
        var tableRow = this.closest('tr'); // Tìm dòng cha của nút được nhấp
        var toast = document.querySelector('.toast'); // Tìm toast trong dòng
        var idTB = "";
        if (tableRow) {
            var idTB = tableRow.cells[1].textContent;
        }
        
        document.querySelector('#idTB').value = idTB;

        var modalEl = document.getElementById('myModal2');
                  var modal = new bootstrap.Modal(modalEl);
                  modal.show();
                       
    });
  });
  
  });
  
  
    //  Chức năng tìm kiếm
    document.addEventListener("DOMContentLoaded", function() {
        var searchInput = document.getElementById("searchInput");
        var searchForm = document.getElementById("searchForm");
        var tableRows = document.querySelectorAll(".table tbody tr");

        searchForm.addEventListener("submit", function(event) {
            event.preventDefault(); // Ngăn form gửi dữ liệu lại server

            var searchText = searchInput.value.toLowerCase();
            tableRows.forEach(function(row) {
                var rowText = row.textContent.toLowerCase();
                if (rowText.includes(searchText)) {
                    row.style.display = ""; // Hiển thị dòng nếu tìm thấy
                } else {
                    row.style.display = "none"; // Ẩn dòng nếu không tìm thấy
                }
            });
        });
    });
</script>
